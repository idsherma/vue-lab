<h1>he <a href="https://travis-ci.org/mathiasbynens/he"><img src="https://travis-ci.org/mathiasbynens/he.svg?branch=master" alt="Build status" /></a> <a href="https://codecov.io/github/mathiasbynens/he?branch=master"><img src="https://codecov.io/github/mathiasbynens/he/coverage.svg?branch=master" alt="Code coverage status" /></a> <a href="https://gemnasium.com/mathiasbynens/he"><img src="https://gemnasium.com/mathiasbynens/he.svg" alt="Dependency status" /></a></h1>

<p><em>he</em> (for â€œHTML entitiesâ€) is a robust HTML entity encoder/decoder written in JavaScript. It supports <a href="https://html.spec.whatwg.org/multipage/syntax.html#named-character-references">all standardized named character references as per HTML</a>, handles <a href="https://mathiasbynens.be/notes/ambiguous-ampersands">ambiguous ampersands</a> and other edge cases <a href="https://html.spec.whatwg.org/multipage/syntax.html#tokenizing-character-references">just like a browser would</a>, has an extensive test suite, and â€” contrary to many other JavaScript solutions â€” <em>he</em> handles astral Unicode symbols just fine. <a href="https://mothereff.in/html-entities">An online demo is available.</a></p>

<h2>Installation</h2>

<p>Via <a href="https://www.npmjs.com/">npm</a>:</p>

<p><code>bash
npm install he
</code></p>

<p>Via <a href="http://bower.io/">Bower</a>:</p>

<p><code>bash
bower install he
</code></p>

<p>Via <a href="https://github.com/component/component">Component</a>:</p>

<p><code>bash
component install mathiasbynens/he
</code></p>

<p>In a browser:</p>

<p><code>html
<script src="he.js"></script>
</code></p>

<p>In <a href="https://nodejs.org/">Node.js</a>, <a href="https://iojs.org/">io.js</a>, <a href="http://narwhaljs.org/">Narwhal</a>, and <a href="http://ringojs.org/">RingoJS</a>:</p>

<p><code>js
var he = require('he');
</code></p>

<p>In <a href="http://www.mozilla.org/rhino/">Rhino</a>:</p>

<p><code>js
load('he.js');
</code></p>

<p>Using an AMD loader like <a href="http://requirejs.org/">RequireJS</a>:</p>

<p><code>js
require(
  {
    'paths': {
      'he': 'path/to/he'
    }
  },
  ['he'],
  function(he) {
    console.log(he);
  }
);
</code></p>

<h2>API</h2>

<h3><code>he.version</code></h3>

<p>A string representing the semantic version number.</p>

<h3><code>he.encode(text, options)</code></h3>

<p>This function takes a string of text and encodes (by default) any symbols that arenâ€™t printable ASCII symbols and <code>&</code>, <code><</code>, <code>></code>, <code>"</code>, <code>'</code>, and <code>`</code>, replacing them with character references.</p>

<p><code>js
he.encode('foo Â© bar â‰  baz ğŒ† qux');
// â†’ 'foo &#xA9; bar &#x2260; baz &#x1D306; qux'
</code></p>

<p>As long as the input string contains <a href="https://html.spec.whatwg.org/multipage/parsing.html#preprocessing-the-input-stream">allowed code points</a> only, the return value of this function is always valid HTML. Any <a href="https://html.spec.whatwg.org/multipage/syntax.html#table-charref-overrides">(invalid) code points that cannot be represented using a character reference</a> in the input are not encoded:</p>

<p><code>js
he.encode('foo \0 bar');
// â†’ 'foo \0 bar'
</code></p>

<p>However, enabling <a href="https://github.com/mathiasbynens/he#strict">the <code>strict</code> option</a> causes invalid code points to throw an exception. With <code>strict</code> enabled, <code>he.encode</code> either throws (if the input contains invalid code points) or returns a string of valid HTML.</p>

<p>The <code>options</code> object is optional. It recognizes the following properties:</p>

<h4><code>useNamedReferences</code></h4>

<p>The default value for the <code>useNamedReferences</code> option is <code>false</code>. This means that <code>encode()</code> will not use any named character references (e.g. <code>&copy;</code>) in the output â€” hexadecimal escapes (e.g. <code>&#xA9;</code>) will be used instead. Set it to <code>true</code> to enable the use of named references.</p>

<p><strong>Note that if compatibility with older browsers is a concern, this option should remain disabled.</strong></p>

<p>```js
// Using the global default setting (defaults to <code>false</code>):
he.encode(â€˜foo Â© bar â‰  baz ğŒ† quxâ€™);
// â†’ â€˜foo Â© bar â‰  baz ğŒ† quxâ€™</p>

<p>// Passing an <code>options</code> object to <code>encode</code>, to explicitly disallow named references:
he.encode(â€˜foo Â© bar â‰  baz ğŒ† quxâ€™, {
  â€˜useNamedReferencesâ€™: false
});
// â†’ â€˜foo Â© bar â‰  baz ğŒ† quxâ€™</p>

<p>// Passing an <code>options</code> object to <code>encode</code>, to explicitly allow named references:
he.encode(â€˜foo Â© bar â‰  baz ğŒ† quxâ€™, {
  â€˜useNamedReferencesâ€™: true
});
// â†’ â€˜foo Â© bar â‰  baz ğŒ† quxâ€™
```</p>

<h4><code>decimal</code></h4>

<p>The default value for the <code>decimal</code> option is <code>false</code>. If the option is enabled, <code>encode</code> will generally use decimal escapes (e.g. <code>&#169;</code>) rather than hexadecimal escapes (e.g. <code>&#xA9;</code>). Beside of this replacement, the basic behavior remains the same when combined with other options. For example: if both options <code>useNamedReferences</code> and <code>decimal</code> are enabled, named references (e.g. <code>&copy;</code>) are used over decimal escapes. HTML entities without a named reference are encoded using decimal escapes.</p>

<p>```js
// Using the global default setting (defaults to <code>false</code>):
he.encode(â€˜foo Â© bar â‰  baz ğŒ† quxâ€™);
// â†’ â€˜foo Â© bar â‰  baz ğŒ† quxâ€™</p>

<p>// Passing an <code>options</code> object to <code>encode</code>, to explicitly disable decimal escapes:
he.encode(â€˜foo Â© bar â‰  baz ğŒ† quxâ€™, {
  â€˜decimalâ€™: false
});
// â†’ â€˜foo Â© bar â‰  baz ğŒ† quxâ€™</p>

<p>// Passing an <code>options</code> object to <code>encode</code>, to explicitly enable decimal escapes:
he.encode(â€˜foo Â© bar â‰  baz ğŒ† quxâ€™, {
  â€˜decimalâ€™: true
});
// â†’ â€˜foo Â© bar â‰  baz ğŒ† quxâ€™</p>

<p>// Passing an <code>options</code> object to <code>encode</code>, to explicitly allow named references and decimal escapes:
he.encode(â€˜foo Â© bar â‰  baz ğŒ† quxâ€™, {
  â€˜useNamedReferencesâ€™: true,
  â€˜decimalâ€™: true
});
// â†’ â€˜foo Â© bar â‰  baz ğŒ† quxâ€™
```</p>

<h4><code>encodeEverything</code></h4>

<p>The default value for the <code>encodeEverything</code> option is <code>false</code>. This means that <code>encode()</code> will not use any character references for printable ASCII symbols that donâ€™t need escaping. Set it to <code>true</code> to encode every symbol in the input string. When set to <code>true</code>, this option takes precedence over <code>allowUnsafeSymbols</code> (i.e. setting the latter to <code>true</code> in such a case has no effect).</p>

<p>```js
// Using the global default setting (defaults to <code>false</code>):
he.encode(â€˜foo Â© bar â‰  baz ğŒ† quxâ€™);
// â†’ â€˜foo Â© bar â‰  baz ğŒ† quxâ€™</p>

<p>// Passing an <code>options</code> object to <code>encode</code>, to explicitly encode all symbols:
he.encode(â€˜foo Â© bar â‰  baz ğŒ† quxâ€™, {
  â€˜encodeEverythingâ€™: true
});
// â†’ â€˜foo Â© bar â‰  baz ğŒ† quxâ€™</p>

<p>// This setting can be combined with the <code>useNamedReferences</code> option:
he.encode(â€˜foo Â© bar â‰  baz ğŒ† quxâ€™, {
  â€˜encodeEverythingâ€™: true,
  â€˜useNamedReferencesâ€™: true
});
// â†’ â€˜foo Â© bar â‰  baz ğŒ† quxâ€™
```</p>

<h4><code>strict</code></h4>

<p>The default value for the <code>strict</code> option is <code>false</code>. This means that <code>encode()</code> will encode any HTML text content you feed it, even if it contains any symbols that cause <a href="https://html.spec.whatwg.org/multipage/parsing.html#preprocessing-the-input-stream">parse errors</a>. To throw an error when such invalid HTML is encountered, set the <code>strict</code> option to <code>true</code>. This option makes it possible to use <em>he</em> as part of HTML parsers and HTML validators.</p>

<p>```js
// Using the global default setting (defaults to <code>false</code>, i.e. error-tolerant mode):
he.encode(â€˜\x01â€™);
// â†’ â€˜â€™</p>

<p>// Passing an <code>options</code> object to <code>encode</code>, to explicitly enable error-tolerant mode:
he.encode(â€˜\x01â€™, {
  â€˜strictâ€™: false
});
// â†’ â€˜â€™</p>

<p>// Passing an <code>options</code> object to <code>encode</code>, to explicitly enable strict mode:
he.encode(â€˜\x01â€™, {
  â€˜strictâ€™: true
});
// â†’ Parse error
```</p>

<h4><code>allowUnsafeSymbols</code></h4>

<p>The default value for the <code>allowUnsafeSymbols</code> option is <code>false</code>. This means that characters that are unsafe for use in HTML content (<code>&</code>, <code><</code>, <code>></code>, <code>"</code>, <code>'</code>, and <code>`</code>) will be encoded. When set to <code>true</code>, only non-ASCII characters will be encoded. If the <code>encodeEverything</code> option is set to <code>true</code>, this option will be ignored.</p>

<p><code>js
he.encode('foo Â© and & ampersand', {
  'allowUnsafeSymbols': true
});
// â†’ 'foo &#xA9; and & ampersand'
</code></p>

<h4>Overriding default <code>encode</code> options globally</h4>

<p>The global default setting can be overridden by modifying the <code>he.encode.options</code> object. This saves you from passing in an <code>options</code> object for every call to <code>encode</code> if you want to use the non-default setting.</p>

<p>```js
// Read the global default setting:
he.encode.options.useNamedReferences;
// â†’ <code>false</code> by default</p>

<p>// Override the global default setting:
he.encode.options.useNamedReferences = true;</p>

<p>// Using the global default setting, which is now <code>true</code>:
he.encode(â€˜foo Â© bar â‰  baz ğŒ† quxâ€™);
// â†’ â€˜foo Â© bar â‰  baz ğŒ† quxâ€™
```</p>

<h3><code>he.decode(html, options)</code></h3>

<p>This function takes a string of HTML and decodes any named and numerical character references in it using <a href="https://html.spec.whatwg.org/multipage/syntax.html#tokenizing-character-references">the algorithm described in section 12.2.4.69 of the HTML spec</a>.</p>

<p><code>js
he.decode('foo &copy; bar &ne; baz &#x1D306; qux');
// â†’ 'foo Â© bar â‰  baz ğŒ† qux'
</code></p>

<p>The <code>options</code> object is optional. It recognizes the following properties:</p>

<h4><code>isAttributeValue</code></h4>

<p>The default value for the <code>isAttributeValue</code> option is <code>false</code>. This means that <code>decode()</code> will decode the string as if it were used in <a href="https://html.spec.whatwg.org/multipage/syntax.html#data-state">a text context in an HTML document</a>. HTML has different rules for <a href="https://html.spec.whatwg.org/multipage/syntax.html#character-reference-in-attribute-value-state">parsing character references in attribute values</a> â€” set this option to <code>true</code> to treat the input string as if it were used as an attribute value.</p>

<p>```js
// Using the global default setting (defaults to <code>false</code>, i.e. HTML text context):
he.decode(â€˜foo&ampbarâ€™);
// â†’ â€˜foo&barâ€™</p>

<p>// Passing an <code>options</code> object to <code>decode</code>, to explicitly assume an HTML text context:
he.decode(â€˜foo&ampbarâ€™, {
  â€˜isAttributeValueâ€™: false
});
// â†’ â€˜foo&barâ€™</p>

<p>// Passing an <code>options</code> object to <code>decode</code>, to explicitly assume an HTML attribute value context:
he.decode(â€˜foo&ampbarâ€™, {
  â€˜isAttributeValueâ€™: true
});
// â†’ â€˜foo&ampbarâ€™
```</p>

<h4><code>strict</code></h4>

<p>The default value for the <code>strict</code> option is <code>false</code>. This means that <code>decode()</code> will decode any HTML text content you feed it, even if it contains any entities that cause <a href="https://html.spec.whatwg.org/multipage/syntax.html#tokenizing-character-references">parse errors</a>. To throw an error when such invalid HTML is encountered, set the <code>strict</code> option to <code>true</code>. This option makes it possible to use <em>he</em> as part of HTML parsers and HTML validators.</p>

<p>```js
// Using the global default setting (defaults to <code>false</code>, i.e. error-tolerant mode):
he.decode(â€˜foo&ampbarâ€™);
// â†’ â€˜foo&barâ€™</p>

<p>// Passing an <code>options</code> object to <code>decode</code>, to explicitly enable error-tolerant mode:
he.decode(â€˜foo&ampbarâ€™, {
  â€˜strictâ€™: false
});
// â†’ â€˜foo&barâ€™</p>

<p>// Passing an <code>options</code> object to <code>decode</code>, to explicitly enable strict mode:
he.decode(â€˜foo&ampbarâ€™, {
  â€˜strictâ€™: true
});
// â†’ Parse error
```</p>

<h4>Overriding default <code>decode</code> options globally</h4>

<p>The global default settings for the <code>decode</code> function can be overridden by modifying the <code>he.decode.options</code> object. This saves you from passing in an <code>options</code> object for every call to <code>decode</code> if you want to use a non-default setting.</p>

<p>```js
// Read the global default setting:
he.decode.options.isAttributeValue;
// â†’ <code>false</code> by default</p>

<p>// Override the global default setting:
he.decode.options.isAttributeValue = true;</p>

<p>// Using the global default setting, which is now <code>true</code>:
he.decode(â€˜foo&ampbarâ€™);
// â†’ â€˜foo&ampbarâ€™
```</p>

<h3><code>he.escape(text)</code></h3>

<p>This function takes a string of text and escapes it for use in text contexts in XML or HTML documents. Only the following characters are escaped: <code>&</code>, <code><</code>, <code>></code>, <code>"</code>, <code>'</code>, and <code>`</code>.</p>

<p><code>js
he.escape('<img src=\'x\' onerror="prompt(1)">');
// â†’ '&lt;img src=&#x27;x&#x27; onerror=&quot;prompt(1)&quot;&gt;'
</code></p>

<h3><code>he.unescape(html, options)</code></h3>

<p><code>he.unescape</code> is an alias for <code>he.decode</code>. It takes a string of HTML and decodes any named and numerical character references in it.</p>

<h3>Using the <code>he</code> binary</h3>

<p>To use the <code>he</code> binary in your shell, simply install <em>he</em> globally using npm:</p>

<p><code>bash
npm install -g he
</code></p>

<p>After that you will be able to encode/decode HTML entities from the command line:</p>

<p>```bash
$ he â€“encode â€˜fÃ¶o â™¥ bÃ¥r ğŒ† bazâ€™
fÃ¶o â™¥ bÃ¥r ğŒ† baz</p>

<p>$ he â€“encode â€“use-named-refs â€˜fÃ¶o â™¥ bÃ¥r ğŒ† bazâ€™
fÃ¶o â™¥ bÃ¥r ğŒ† baz</p>

<p>$ he â€“decode â€˜fÃ¶o â™¥ bÃ¥r ğŒ† bazâ€™
fÃ¶o â™¥ bÃ¥r ğŒ† baz
```</p>

<p>Read a local text file, encode it for use in an HTML text context, and save the result to a new file:</p>

<p><code>bash
$ he --encode < foo.txt > foo-escaped.html
</code></p>

<p>Or do the same with an online text file:</p>

<p><code>bash
$ curl -sL "http://git.io/HnfEaw" | he --encode > escaped.html
</code></p>

<p>Or, the opposite â€” read a local file containing a snippet of HTML in a text context, decode it back to plain text, and save the result to a new file:</p>

<p><code>bash
$ he --decode < foo-escaped.html > foo.txt
</code></p>

<p>Or do the same with an online HTML snippet:</p>

<p><code>bash
$ curl -sL "http://git.io/HnfEaw" | he --decode > decoded.txt
</code></p>

<p>See <code>he --help</code> for the full list of options.</p>

<h2>Support</h2>

<p><em>he</em> has been tested in at least:</p>

<ul>
  <li>Chrome 27-50</li>
  <li>Firefox 3-45</li>
  <li>Safari 4-9</li>
  <li>Opera 10-12, 15â€“37</li>
  <li>IE 6â€“11</li>
  <li>Edge</li>
  <li>Narwhal 0.3.2</li>
  <li>Node.js v0.10, v0.12, v4, v5</li>
  <li>PhantomJS 1.9.0</li>
  <li>Rhino 1.7RC4</li>
  <li>RingoJS 0.8-0.11</li>
</ul>

<h2>Unit tests & code coverage</h2>

<p>After cloning this repository, run <code>npm install</code> to install the dependencies needed for he development and testing. You may want to install Istanbul <em>globally</em> using <code>npm install istanbul -g</code>.</p>

<p>Once thatâ€™s done, you can run the unit tests in Node using <code>npm test</code> or <code>node tests/tests.js</code>. To run the tests in Rhino, Ringo, Narwhal, and web browsers as well, use <code>grunt test</code>.</p>

<p>To generate the code coverage report, use <code>grunt cover</code>.</p>

<h2>Acknowledgements</h2>

<p>Thanks to <a href="https://simon.html5.org/">Simon Pieters</a> (<a href="https://twitter.com/zcorpan">@zcorpan</a>) for the many suggestions.</p>

<h2>Author</h2>

<table>
  <thead>
    <tr>
      <th><a href="https://twitter.com/mathias" title="Follow @mathias on Twitter"><img src="https://gravatar.com/avatar/24e08a9ea84deb17ae121074d0f17125?s=70" alt="twitter/mathias" /></a></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="https://mathiasbynens.be/">Mathias Bynens</a></td>
    </tr>
  </tbody>
</table>

<h2>License</h2>

<p><em>he</em> is available under the <a href="https://mths.be/mit">MIT</a> license.</p>