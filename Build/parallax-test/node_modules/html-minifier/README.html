<h1>HTMLMinifier</h1>

<p><a href="https://www.npmjs.com/package/html-minifier"><img src="https://img.shields.io/npm/v/html-minifier.svg" alt="NPM version" /></a>
<a href="https://travis-ci.org/kangax/html-minifier"><img src="https://img.shields.io/travis/kangax/html-minifier.svg" alt="Build Status" /></a>
<a href="https://david-dm.org/kangax/html-minifier"><img src="https://img.shields.io/david/kangax/html-minifier.svg" alt="Dependency Status" /></a>
<a href="https://david-dm.org/kangax/html-minifier?type=dev"><img src="https://img.shields.io/david/dev/kangax/html-minifier.svg" alt="devDependency Status" /></a>
<a href="https://gitter.im/kangax/html-minifier"><img src="https://img.shields.io/gitter/room/kangax/html-minifier.svg" alt="Gitter" /></a></p>

<p><a href="http://kangax.github.io/html-minifier/">HTMLMinifier</a> is a highly <strong>configurable</strong>, <strong>well-tested</strong>, JavaScript-based HTML minifier.</p>

<p>See <a href="http://perfectionkills.com/experimenting-with-html-minifier/">corresponding blog post</a> for all the gory details of <a href="http://perfectionkills.com/experimenting-with-html-minifier/#how_it_works">how it works</a>, <a href="http://perfectionkills.com/experimenting-with-html-minifier/#options">description of each option</a>, <a href="http://perfectionkills.com/experimenting-with-html-minifier/#field_testing">testing results</a> and <a href="http://perfectionkills.com/experimenting-with-html-minifier/#cost_and_benefits">conclusions</a>.</p>

<p><a href="http://kangax.github.io/html-minifier/tests/">Test suite is available online</a>.</p>

<p>Also see corresponding <a href="https://github.com/stereobooster/html_minifier">Ruby wrapper</a>, and for Node.js, <a href="https://github.com/gruntjs/grunt-contrib-htmlmin">Grunt plugin</a>, <a href="https://github.com/jonschlinkert/gulp-htmlmin">Gulp module</a>, <a href="https://github.com/koajs/html-minifier">Koa middleware wrapper</a> and <a href="https://github.com/melonmanchan/express-minify-html">Express middleware wrapper</a>.</p>

<p>For lint-like capabilities take a look at <a href="https://github.com/kangax/html-lint">HTMLLint</a>.</p>

<h2>Minification comparison</h2>

<p>How does HTMLMinifier compare to other solutions — <a href="http://www.willpeavy.com/minifier/">HTML Minifier from Will Peavy</a> (1st result in <a href="https://www.google.com/#q=html+minifier">Google search for “html minifier”</a>) as well as <a href="http://htmlcompressor.com">htmlcompressor.com</a> and <a href="https://github.com/Swaagie/minimize">minimize</a>?</p>

<table>
  <thead>
    <tr>
      <th>Site</th>
      <th style="text-align: center">Original size <em>(KB)</em></th>
      <th style="text-align: right">HTMLMinifier</th>
      <th style="text-align: right">minimize</th>
      <th style="text-align: right">Will Peavy</th>
      <th style="text-align: right">htmlcompressor.com</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="https://www.google.com/">Google</a></td>
      <td style="text-align: center">46</td>
      <td style="text-align: right"><strong>43</strong></td>
      <td style="text-align: right">46</td>
      <td style="text-align: right">48</td>
      <td style="text-align: right">46</td>
    </tr>
    <tr>
      <td><a href="https://github.com/kangax/html-minifier">HTMLMinifier</a></td>
      <td style="text-align: center">134</td>
      <td style="text-align: right"><strong>104</strong></td>
      <td style="text-align: right">112</td>
      <td style="text-align: right">117</td>
      <td style="text-align: right">112</td>
    </tr>
    <tr>
      <td><a href="https://www.nytimes.com/">New York Times</a></td>
      <td style="text-align: center">209</td>
      <td style="text-align: right"><strong>140</strong></td>
      <td style="text-align: right">159</td>
      <td style="text-align: right">158</td>
      <td style="text-align: right">147</td>
    </tr>
    <tr>
      <td><a href="https://stackoverflow.com/">Stack Overflow</a></td>
      <td style="text-align: center">252</td>
      <td style="text-align: right"><strong>197</strong></td>
      <td style="text-align: right">207</td>
      <td style="text-align: right">215</td>
      <td style="text-align: right">204</td>
    </tr>
    <tr>
      <td><a href="https://www.bbc.co.uk/">BBC</a></td>
      <td style="text-align: center">260</td>
      <td style="text-align: right"><strong>213</strong></td>
      <td style="text-align: right">252</td>
      <td style="text-align: right">259</td>
      <td style="text-align: right">245</td>
    </tr>
    <tr>
      <td><a href="https://getbootstrap.com/docs/3.3/css/">Bootstrap CSS</a></td>
      <td style="text-align: center">272</td>
      <td style="text-align: right"><strong>260</strong></td>
      <td style="text-align: right">269</td>
      <td style="text-align: right">229</td>
      <td style="text-align: right">269</td>
    </tr>
    <tr>
      <td><a href="https://twitter.com/">Twitter</a></td>
      <td style="text-align: center">333</td>
      <td style="text-align: right"><strong>248</strong></td>
      <td style="text-align: right">297</td>
      <td style="text-align: right">326</td>
      <td style="text-align: right">297</td>
    </tr>
    <tr>
      <td><a href="https://en.wikipedia.org/wiki/President_of_the_United_States">Wikipedia</a></td>
      <td style="text-align: center">466</td>
      <td style="text-align: right"><strong>435</strong></td>
      <td style="text-align: right">451</td>
      <td style="text-align: right">465</td>
      <td style="text-align: right">450</td>
    </tr>
    <tr>
      <td><a href="https://www.amazon.co.uk/">Amazon</a></td>
      <td style="text-align: center">476</td>
      <td style="text-align: right"><strong>409</strong></td>
      <td style="text-align: right">462</td>
      <td style="text-align: right">466</td>
      <td style="text-align: right">n/a</td>
    </tr>
    <tr>
      <td><a href="https://www.nbc.com/">NBC</a></td>
      <td style="text-align: center">625</td>
      <td style="text-align: right"><strong>595</strong></td>
      <td style="text-align: right">622</td>
      <td style="text-align: right">625</td>
      <td style="text-align: right">n/a</td>
    </tr>
    <tr>
      <td><a href="https://eloquentjavascript.net/1st_edition/print.html">Eloquent Javascript</a></td>
      <td style="text-align: center">870</td>
      <td style="text-align: right"><strong>815</strong></td>
      <td style="text-align: right">840</td>
      <td style="text-align: right">864</td>
      <td style="text-align: right">n/a</td>
    </tr>
    <tr>
      <td><a href="https://kangax.github.io/compat-table/es6/">ES6 table</a></td>
      <td style="text-align: center">4174</td>
      <td style="text-align: right"><strong>3538</strong></td>
      <td style="text-align: right">3944</td>
      <td style="text-align: right">n/a</td>
      <td style="text-align: right">n/a</td>
    </tr>
    <tr>
      <td><a href="https://tc39.github.io/ecma262/">ES6 draft</a></td>
      <td style="text-align: center">5717</td>
      <td style="text-align: right"><strong>5101</strong></td>
      <td style="text-align: right">5250</td>
      <td style="text-align: right">n/a</td>
      <td style="text-align: right">n/a</td>
    </tr>
  </tbody>
</table>

<h2>Options Quick Reference</h2>

<p>Most of the options are disabled by default.</p>

<table>
  <thead>
    <tr>
      <th>Option</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>caseSensitive</code></td>
      <td>Treat attributes in case sensitive manner (useful for custom HTML tags)</td>
      <td><code>false</code></td>
    </tr>
    <tr>
      <td><code>collapseBooleanAttributes</code></td>
      <td><a href="http://perfectionkills.com/experimenting-with-html-minifier/#collapse_boolean_attributes">Omit attribute values from boolean attributes</a></td>
      <td><code>false</code></td>
    </tr>
    <tr>
      <td><code>collapseInlineTagWhitespace</code></td>
      <td>Don’t leave any spaces between <code>display:inline;</code> elements when collapsing. Must be used in conjunction with <code>collapseWhitespace=true</code></td>
      <td><code>false</code></td>
    </tr>
    <tr>
      <td><code>collapseWhitespace</code></td>
      <td><a href="http://perfectionkills.com/experimenting-with-html-minifier/#collapse_whitespace">Collapse white space that contributes to text nodes in a document tree</a></td>
      <td><code>false</code></td>
    </tr>
    <tr>
      <td><code>conservativeCollapse</code></td>
      <td>Always collapse to 1 space (never remove it entirely). Must be used in conjunction with <code>collapseWhitespace=true</code></td>
      <td><code>false</code></td>
    </tr>
    <tr>
      <td><code>customAttrAssign</code></td>
      <td>Arrays of regex’es that allow to support custom attribute assign expressions (e.g. <code>'<div flex?="{{mode != cover}}"></div>'</code>)</td>
      <td><code>[ ]</code></td>
    </tr>
    <tr>
      <td><code>customAttrCollapse</code></td>
      <td>Regex that specifies custom attribute to strip newlines from (e.g. <code>/ng-class/</code>)</td>
      <td> </td>
    </tr>
    <tr>
      <td><code>customAttrSurround</code></td>
      <td>Arrays of regex’es that allow to support custom attribute surround expressions (e.g. <code><input {{#if value}}checked="checked"{{/if}}></code>)</td>
      <td><code>[ ]</code></td>
    </tr>
    <tr>
      <td><code>customEventAttributes</code></td>
      <td>Arrays of regex’es that allow to support custom event attributes for <code>minifyJS</code> (e.g. <code>ng-click</code>)</td>
      <td><code>[ /^on[a-z]{3,}$/ ]</code></td>
    </tr>
    <tr>
      <td><code>decodeEntities</code></td>
      <td>Use direct Unicode characters whenever possible</td>
      <td><code>false</code></td>
    </tr>
    <tr>
      <td><code>html5</code></td>
      <td>Parse input according to HTML5 specifications</td>
      <td><code>true</code></td>
    </tr>
    <tr>
      <td><code>ignoreCustomComments</code></td>
      <td>Array of regex’es that allow to ignore certain comments, when matched</td>
      <td><code>[ /^!/ ]</code></td>
    </tr>
    <tr>
      <td><code>ignoreCustomFragments</code></td>
      <td>Array of regex’es that allow to ignore certain fragments, when matched (e.g. <code><?php ... ?></code>, <code>{{ ... }}</code>, etc.)</td>
      <td><code>[ /<%[\s\S]*?%>/, /<\?[\s\S]*?\?>/ ]</code></td>
    </tr>
    <tr>
      <td><code>includeAutoGeneratedTags</code></td>
      <td>Insert tags generated by HTML parser</td>
      <td><code>true</code></td>
    </tr>
    <tr>
      <td><code>keepClosingSlash</code></td>
      <td>Keep the trailing slash on singleton elements</td>
      <td><code>false</code></td>
    </tr>
    <tr>
      <td><code>maxLineLength</code></td>
      <td>Specify a maximum line length. Compressed output will be split by newlines at valid HTML split-points</td>
      <td> </td>
    </tr>
    <tr>
      <td><code>minifyCSS</code></td>
      <td>Minify CSS in style elements and style attributes (uses <a href="https://github.com/jakubpawlowicz/clean-css">clean-css</a>)</td>
      <td><code>false</code> (could be <code>true</code>, <code>Object</code>, <code>Function(text)</code>)</td>
    </tr>
    <tr>
      <td><code>minifyJS</code></td>
      <td>Minify JavaScript in script elements and event attributes (uses <a href="https://github.com/mishoo/UglifyJS2">UglifyJS</a>)</td>
      <td><code>false</code> (could be <code>true</code>, <code>Object</code>, <code>Function(text, inline)</code>)</td>
    </tr>
    <tr>
      <td><code>minifyURLs</code></td>
      <td>Minify URLs in various attributes (uses <a href="https://github.com/stevenvachon/relateurl">relateurl</a>)</td>
      <td><code>false</code> (could be <code>String</code>, <code>Object</code>, <code>Function(text)</code>)</td>
    </tr>
    <tr>
      <td><code>preserveLineBreaks</code></td>
      <td>Always collapse to 1 line break (never remove it entirely) when whitespace between tags include a line break. Must be used in conjunction with <code>collapseWhitespace=true</code></td>
      <td><code>false</code></td>
    </tr>
    <tr>
      <td><code>preventAttributesEscaping</code></td>
      <td>Prevents the escaping of the values of attributes</td>
      <td><code>false</code></td>
    </tr>
    <tr>
      <td><code>processConditionalComments</code></td>
      <td>Process contents of conditional comments through minifier</td>
      <td><code>false</code></td>
    </tr>
    <tr>
      <td><code>processScripts</code></td>
      <td>Array of strings corresponding to types of script elements to process through minifier (e.g. <code>text/ng-template</code>, <code>text/x-handlebars-template</code>, etc.)</td>
      <td><code>[ ]</code></td>
    </tr>
    <tr>
      <td><code>quoteCharacter</code></td>
      <td>Type of quote to use for attribute values (‘ or “)</td>
      <td> </td>
    </tr>
    <tr>
      <td><code>removeAttributeQuotes</code></td>
      <td><a href="http://perfectionkills.com/experimenting-with-html-minifier/#remove_attribute_quotes">Remove quotes around attributes when possible</a></td>
      <td><code>false</code></td>
    </tr>
    <tr>
      <td><code>removeComments</code></td>
      <td><a href="http://perfectionkills.com/experimenting-with-html-minifier/#remove_comments">Strip HTML comments</a></td>
      <td><code>false</code></td>
    </tr>
    <tr>
      <td><code>removeEmptyAttributes</code></td>
      <td><a href="http://perfectionkills.com/experimenting-with-html-minifier/#remove_empty_or_blank_attributes">Remove all attributes with whitespace-only values</a></td>
      <td><code>false</code> (could be <code>true</code>, <code>Function(attrName, tag)</code>)</td>
    </tr>
    <tr>
      <td><code>removeEmptyElements</code></td>
      <td><a href="http://perfectionkills.com/experimenting-with-html-minifier/#remove_empty_elements">Remove all elements with empty contents</a></td>
      <td><code>false</code></td>
    </tr>
    <tr>
      <td><code>removeOptionalTags</code></td>
      <td><a href="http://perfectionkills.com/experimenting-with-html-minifier/#remove_optional_tags">Remove optional tags</a></td>
      <td><code>false</code></td>
    </tr>
    <tr>
      <td><code>removeRedundantAttributes</code></td>
      <td><a href="http://perfectionkills.com/experimenting-with-html-minifier/#remove_redundant_attributes">Remove attributes when value matches default.</a></td>
      <td><code>false</code></td>
    </tr>
    <tr>
      <td><code>removeScriptTypeAttributes</code></td>
      <td>Remove <code>type="text/javascript"</code> from <code>script</code> tags. Other <code>type</code> attribute values are left intact</td>
      <td><code>false</code></td>
    </tr>
    <tr>
      <td><code>removeStyleLinkTypeAttributes</code></td>
      <td>Remove <code>type="text/css"</code> from <code>style</code> and <code>link</code> tags. Other <code>type</code> attribute values are left intact</td>
      <td><code>false</code></td>
    </tr>
    <tr>
      <td><code>removeTagWhitespace</code></td>
      <td>Remove space between attributes whenever possible. <strong>Note that this will result in invalid HTML!</strong></td>
      <td><code>false</code></td>
    </tr>
    <tr>
      <td><code>sortAttributes</code></td>
      <td><a href="#sorting-attributes--style-classes">Sort attributes by frequency</a></td>
      <td><code>false</code></td>
    </tr>
    <tr>
      <td><code>sortClassName</code></td>
      <td><a href="#sorting-attributes--style-classes">Sort style classes by frequency</a></td>
      <td><code>false</code></td>
    </tr>
    <tr>
      <td><code>trimCustomFragments</code></td>
      <td>Trim white space around <code>ignoreCustomFragments</code>.</td>
      <td><code>false</code></td>
    </tr>
    <tr>
      <td><code>useShortDoctype</code></td>
      <td><a href="http://perfectionkills.com/experimenting-with-html-minifier/#use_short_doctype">Replaces the <code>doctype</code> with the short (HTML5) doctype</a></td>
      <td><code>false</code></td>
    </tr>
  </tbody>
</table>

<h3>Sorting attributes / style classes</h3>

<p>Minifier options like <code>sortAttributes</code> and <code>sortClassName</code> won’t impact the plain-text size of the output. However, they form long repetitive chains of characters that should improve compression ratio of gzip used in HTTP compression.</p>

<h2>Special cases</h2>

<h3>Ignoring chunks of markup</h3>

<p>If you have chunks of markup you would like preserved, you can wrap them <code><!-- htmlmin:ignore --></code>.</p>

<h3>Preserving SVG tags</h3>

<p>SVG tags are automatically recognized, and when they are minified, both case-sensitivity and closing-slashes are preserved, regardless of the minification settings used for the rest of the file.</p>

<h3>Working with invalid markup</h3>

<p>HTMLMinifier <strong>can’t work with invalid or partial chunks of markup</strong>. This is because it parses markup into a tree structure, then modifies it (removing anything that was specified for removal, ignoring anything that was specified to be ignored, etc.), then it creates a markup out of that tree and returns it.</p>

<p>Input markup (e.g. <code><p id="">foo</code>)</p>

<p>↓</p>

<p>Internal representation of markup in a form of tree (e.g. <code>{ tag: "p", attr: "id", children: ["foo"] }</code>)</p>

<p>↓</p>

<p>Transformation of internal representation (e.g. removal of <code>id</code> attribute)</p>

<p>↓</p>

<p>Output of resulting markup (e.g. <code><p>foo</p></code>)</p>

<p>HTMLMinifier can’t know that original markup was only half of the tree; it does its best to try to parse it as a full tree and it loses information about tree being malformed or partial in the beginning. As a result, it can’t create a partial/malformed tree at the time of the output.</p>

<h2>Installation Instructions</h2>

<p>From NPM for use as a command line app:</p>

<p><code>shell
npm install html-minifier -g
</code></p>

<p>From NPM for programmatic use:</p>

<p><code>shell
npm install html-minifier
</code></p>

<p>From Git:</p>

<p><code>shell
git clone git://github.com/kangax/html-minifier.git
cd html-minifier
npm link .
</code></p>

<h2>Usage</h2>

<p>For command line usage please see <code>html-minifier --help</code></p>

<h3>Node.js</h3>

<p><code>js
var minify = require('html-minifier').minify;
var result = minify('<p title="blah" id="moo">foo</p>', {
  removeAttributeQuotes: true
});
result; // '<p title=blah id=moo>foo</p>'
</code></p>

<h2>Running benchmarks</h2>

<p>Benchmarks for minified HTML:</p>

<p><code>shell
node benchmark.js
</code></p>