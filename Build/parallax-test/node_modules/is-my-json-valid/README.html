<h1>is-my-json-valid</h1>

<p>A <a href="http://json-schema.org/">JSONSchema</a> validator that uses code generation
to be extremely fast</p>

<p><code>
npm install is-my-json-valid
</code></p>

<p>It passes the entire JSONSchema v4 test suite except for <code>remoteRefs</code> and <code>maxLength</code>/<code>minLength</code> when using unicode surrogate pairs.</p>

<p><a href="http://travis-ci.org/mafintosh/is-my-json-valid"><img src="http://img.shields.io/travis/mafintosh/is-my-json-valid.svg?style=flat" alt="build status" /></a></p>

<h2>Usage</h2>

<p>Simply pass a schema to compile it</p>

<p>``` js
var validator = require(‘is-my-json-valid’)</p>

<p>var validate = validator({
  required: true,
  type: ‘object’,
  properties: {
    hello: {
      required: true,
      type: ‘string’
    }
  }
})</p>

<p>console.log(‘should be valid’, validate({hello: ‘world’}))
console.log(‘should not be valid’, validate({}))</p>

<p>// get the last list of errors by checking validate.errors
// the following will print [{field: ‘data.hello’, message: ‘is required’}]
console.log(validate.errors)
```</p>

<p>You can also pass the schema as a string</p>

<p><code>js
var validate = validator('{"type": ... }')
</code></p>

<p>Optionally you can use the require submodule to load a schema from <code>__dirname</code></p>

<p><code>js
var validator = require('is-my-json-valid/require')
var validate = validator('my-schema.json')
</code></p>

<h2>Custom formats</h2>

<p>is-my-json-valid supports the formats specified in JSON schema v4 (such as date-time).
If you want to add your own custom formats pass them as the formats options to the validator</p>

<p>``` js
var validate = validator({
  type: ‘string’,
  required: true,
  format: ‘only-a’
}, {
  formats: {
    ‘only-a’: /^a+$/
  }
})</p>

<p>console.log(validate(‘aa’)) // true
console.log(validate(‘ab’)) // false
```</p>

<h2>External schemas</h2>

<p>You can pass in external schemas that you reference using the <code>$ref</code> attribute as the <code>schemas</code> option</p>

<p>``` js
var ext = {
  required: true,
  type: ‘string’
}</p>

<p>var schema = {
  $ref: ‘#ext’ // references another schema called ext
}</p>

<p>// pass the external schemas as an option
var validate = validator(schema, {schemas: {ext: ext}})</p>

<p>validate(‘hello’) // returns true
validate(42) // return false
```</p>

<h2>Filtering away additional properties</h2>

<p>is-my-json-valid supports filtering away properties not in the schema</p>

<p>``` js
var filter = validator.filter({
  required: true,
  type: ‘object’,
  properties: {
    hello: {type: ‘string’, required: true}
  },
  additionalProperties: false
})</p>

<p>var doc = {hello: ‘world’, notInSchema: true}
console.log(filter(doc)) // {hello: ‘world’}
```</p>

<h2>Verbose mode shows more information about the source of the error</h2>

<p>When the <code>verbose</code> options is set to <code>true</code>, <code>is-my-json-valid</code> also outputs:</p>

<ul>
  <li><code>value</code>: The data value that caused the error</li>
  <li><code>schemaPath</code>: an array of keys indicating which sub-schema failed</li>
</ul>

<p>``` js
var schema = {
  required: true,
  type: ‘object’,
  properties: {
    hello: {
      required: true,
      type: ‘string’
    }
  }
}
var validate = validator(schema, {
  verbose: true
})</p>

<p>validate({hello: 100});
console.log(validate.errors)
// [ { field: ‘data.hello’,
//     message: ‘is the wrong type’,
//     value: 100,
//     type: ‘string’,
//     schemaPath: [ ‘properties’, ‘hello’ ] } ]
```</p>

<p>Many popular libraries make it easy to retrieve the failing rule with the <code>schemaPath</code>:
```
var schemaPath = validate.errors[0].schemaPath
var R = require(‘ramda’)</p>

<p>console.log( ‘All evaluate to the same thing: ‘, R.equals(
  schema.properties.hello,
  { required: true, type: ‘string’ },
  R.path(schemaPath, schema),
  require(‘lodash’).get(schema, schemaPath),
  require(‘jsonpointer’).get(schema, [””].concat(schemaPath))
))
// All evaluate to the same thing: true
```</p>

<h2>Greedy mode tries to validate as much as possible</h2>

<p>By default is-my-json-valid bails on first validation error but when greedy is
set to true it tries to validate as much as possible:</p>

<p>``` js
var validate = validator({
  type: ‘object’,
  properties: {
    x: {
      type: ‘number’
    }
  },
  required: [‘x’, ‘y’]
}, {
  greedy: true
});</p>

<p>validate({x: ‘string’});
console.log(validate.errors) // [{field: ‘data.y’, message: ‘is required’},
                             //  {field: ‘data.x’, message: ‘is the wrong type’}]
```</p>

<h2>Error messages</h2>

<p>Here is a list of possible <code>message</code> values for errors:</p>

<ul>
  <li><code>is required</code></li>
  <li><code>is the wrong type</code></li>
  <li><code>has additional items</code></li>
  <li><code>must be FORMAT format</code> (FORMAT is the <code>format</code> property from the schema)</li>
  <li><code>must be unique</code></li>
  <li><code>must be an enum value</code></li>
  <li><code>dependencies not set</code></li>
  <li><code>has additional properties</code></li>
  <li><code>referenced schema does not match</code></li>
  <li><code>negative schema matches</code></li>
  <li><code>pattern mismatch</code></li>
  <li><code>no schemas match</code></li>
  <li><code>no (or more than one) schemas match</code></li>
  <li><code>has a remainder</code></li>
  <li><code>has more properties than allowed</code></li>
  <li><code>has less properties than allowed</code></li>
  <li><code>has more items than allowed</code></li>
  <li><code>has less items than allowed</code></li>
  <li><code>has longer length than allowed</code></li>
  <li><code>has less length than allowed</code></li>
  <li><code>is less than minimum</code></li>
  <li><code>is more than maximum</code></li>
</ul>

<h2>Performance</h2>

<p>is-my-json-valid uses code generation to turn your JSON schema into basic javascript code that is easily optimizeable by v8.</p>

<p>At the time of writing, is-my-json-valid is the <strong>fastest validator</strong> when running</p>

<ul>
  <li><a href="https://github.com/Muscula/json-schema-benchmark">json-schema-benchmark</a></li>
  <li><a href="http://cosmicrealms.com/blog/2014/08/29/benchmark-of-node-dot-js-json-validation-modules-part-3/">cosmicreals.com benchmark</a></li>
  <li><a href="https://github.com/pandastrike/jsck/issues/72#issuecomment-70992684">jsck benchmark</a></li>
  <li><a href="https://cdn.rawgit.com/playlyfe/themis/master/benchmark/results.html">themis benchmark</a></li>
  <li><a href="https://rawgit.com/zaggino/z-schema/master/benchmark/results.html">z-schema benchmark</a></li>
</ul>

<p>If you know any other relevant benchmarks open a PR and I’ll add them.</p>

<h2>License</h2>

<p>MIT</p>