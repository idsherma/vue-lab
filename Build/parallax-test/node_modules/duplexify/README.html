<h1>duplexify</h1>

<p>Turn a writeable and readable stream into a single streams2 duplex stream.</p>

<p>Similar to <a href="https://github.com/deoxxa/duplexer2">duplexer2</a> except it supports both streams2 and streams1 as input
and it allows you to set the readable and writable part asynchronously using <code>setReadable(stream)</code> and <code>setWritable(stream)</code></p>

<p><code>
npm install duplexify
</code></p>

<p><a href="http://travis-ci.org/mafintosh/duplexify"><img src="http://img.shields.io/travis/mafintosh/duplexify.svg?style=flat" alt="build status" /></a></p>

<h2>Usage</h2>

<p>Use <code>duplexify(writable, readable, streamOptions)</code> (or <code>duplexify.obj(writable, readable)</code> to create an object stream)</p>

<p>``` js
var duplexify = require(‘duplexify’)</p>

<p>// turn writableStream and readableStream into a single duplex stream
var dup = duplexify(writableStream, readableStream)</p>

<p>dup.write(‘hello world’) // will write to writableStream
dup.on(‘data’, function(data) {
  // will read from readableStream
})
```</p>

<p>You can also set the readable and writable parts asynchronously</p>

<p>``` js
var dup = duplexify()</p>

<p>dup.write(‘hello world’) // write will buffer until the writable
                         // part has been set</p>

<p>// wait a bit …
dup.setReadable(readableStream)</p>

<p>// maybe wait some more?
dup.setWritable(writableStream)
```</p>

<p>If you call <code>setReadable</code> or <code>setWritable</code> multiple times it will unregister the previous readable/writable stream.
To disable the readable or writable part call <code>setReadable</code> or <code>setWritable</code> with <code>null</code>.</p>

<p>If the readable or writable streams emits an error or close it will destroy both streams and bubble up the event.
You can also explictly destroy the streams by calling <code>dup.destroy()</code>. The <code>destroy</code> method optionally takes an
error object as argument, in which case the error is emitted as part of the <code>error</code> event.</p>

<p>``` js
dup.on(‘error’, function(err) {
  console.log(‘readable or writable emitted an error - close will follow’)
})</p>

<p>dup.on(‘close’, function() {
  console.log(‘the duplex stream is destroyed’)
})</p>

<p>dup.destroy() // calls destroy on the readable and writable part (if present)
```</p>

<h2>HTTP request example</h2>

<p>Turn a node core http request into a duplex stream is as easy as</p>

<p>``` js
var duplexify = require(‘duplexify’)
var http = require(‘http’)</p>

<p>var request = function(opts) {
  var req = http.request(opts)
  var dup = duplexify(req)
  req.on(‘response’, function(res) {
    dup.setReadable(res)
  })
  return dup
}</p>

<p>var req = request({
  method: ‘GET’,
  host: ‘www.google.com’,
  port: 80
})</p>

<p>req.end()
req.pipe(process.stdout)
```</p>

<h2>License</h2>

<p>MIT</p>

<h2>Related</h2>

<p><code>duplexify</code> is part of the <a href="https://github.com/maxogden/mississippi">mississippi stream utility collection</a> which includes more useful stream modules similar to this one.</p>