<h1>Serialize JavaScript</h1>

<p>Serialize JavaScript to a <em>superset</em> of JSON that includes regular expressions, dates and functions.</p>

<p><a href="https://www.npmjs.org/package/serialize-javascript"><img src="https://img.shields.io/npm/v/serialize-javascript.svg?style=flat-square" alt="npm Version" /></a>
<a href="https://david-dm.org/yahoo/serialize-javascript"><img src="https://img.shields.io/david/yahoo/serialize-javascript.svg?style=flat-square" alt="Dependency Status" /></a>
<a href="https://travis-ci.org/yahoo/serialize-javascript"><img src="https://img.shields.io/travis/yahoo/serialize-javascript.svg?style=flat-square" alt="Build Status" /></a></p>

<h2>Overview</h2>

<p>The code in this package began its life as an internal module to <a href="https://github.com/yahoo/express-state">express-state</a>. To expand its usefulness, it now lives as <code>serialize-javascript</code> — an independent package on npm.</p>

<p>You’re probably wondering: <strong>What about <code>JSON.stringify()</code>!?</strong> We’ve found that sometimes we need to serialize JavaScript <strong>functions</strong>, <strong>regexps</strong> or <strong>dates</strong>. A great example is a web app that uses client-side URL routing where the route definitions are regexps that need to be shared from the server to the client.</p>

<p>The string returned from this package’s single export function is literal JavaScript which can be saved to a <code>.js</code> file, or be embedded into an HTML document by making the content of a <code><script></code> element. <strong>HTML charaters and JavaScript line terminators are escaped automatically.</strong></p>

<h2>Installation</h2>

<p>Install using npm:</p>

<p><code>shell
$ npm install serialize-javascript
</code></p>

<h2>Usage</h2>

<p>```js
var serialize = require(‘serialize-javascript’);</p>

<p>serialize({
    str  : ‘string’,
    num  : 0,
    obj  : {foo: ‘foo’},
    arr  : [1, 2, 3],
    bool : true,
    nil  : null,
    undef: undefined,
    date: new Date(“Thu, 28 Apr 2016 22:02:17 GMT”),</p>

<pre><code>fn: function echo(arg) { return arg; },
re: /([^\s]+)/g }); ```
</code></pre>

<p>The above will produce the following string output:</p>

<p><code>js
'{"str":"string","num":0,"obj":{"foo":"foo"},"arr":[1,2,3],"bool":true,"nil":null,date:new Date("2016-04-28T22:02:17.156Z"),"fn":function echo(arg) { return arg; },"re":/([^\\s]+)/g}'
</code></p>

<p>Note: to produced a beautified string, you can pass an optional second argument to <code>serialize()</code> to define the number of spaces to be used for the indentation.</p>

<h3>Automatic Escaping of HTML Characters</h3>

<p>A primary feature of this package is to serialize code to a string of literal JavaScript which can be embedded in an HTML document by adding it as the contents of the <code><script></code> element. In order to make this safe, HTML characters and JavaScript line terminators are escaped automatically.</p>

<p><code>js
serialize({
    haxorXSS: '</script>'
});
</code></p>

<p>The above will produce the following string, HTML-escaped output which is safe to put into an HTML document as it will not cause the inline script element to terminate:</p>

<p><code>js
'{"haxorXSS":"\\u003C\\u002Fscript\\u003E"}'
</code></p>

<h3>Options</h3>

<p>The <code>serialize()</code> function accepts <code>options</code> as its second argument. There are two options, both default to being <code>undefined</code>:</p>

<h4><code>options.space</code></h4>

<p>This option is the same as the <code>space</code> argument that can be passed to <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify"><code>JSON.stringify</code></a>. It can be used to add whitespace and indentation to the serialized output to make it more readable.</p>

<p><code>js
serialize(obj, {space: 2});
</code></p>

<h4><code>options.isJSON</code></h4>

<p>This option is a signal to <code>serialize()</code> that the object being serialized does not contain any function or regexps values. This enables a hot-path that allows serialization to be over 3x faster. If you’re serializing a lot of data, and know its pure JSON, then you can enable this option for a speed-up.</p>

<p><strong>Note:</strong> That when using this option, the output will still be escaped to protect against XSS.</p>

<p><code>js
serialize(obj, {isJSON: true});
</code></p>

<h2>Deserializing</h2>

<p>For some use cases you might also need to deserialize the string. This is explicitely not part of this module. However, you can easily write it yourself:</p>

<p><code>js
function deserialize(serializedJavascript){
  return eval('(' + serializedJavascript + ')');
}
</code></p>

<p><strong>Note:</strong> Don’t forget the parentheses around the serialized javascript, as the opening bracket <code>{</code> will be considered to be the start of a body.</p>

<h2>License</h2>

<p>This software is free to use under the Yahoo! Inc. BSD license.
See the <a href="https://github.com/yahoo/serialize-javascript/blob/master/LICENSE">LICENSE file</a> for license text and copyright information.</p>