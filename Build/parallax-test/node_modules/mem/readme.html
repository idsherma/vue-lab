<h1>mem <a href="https://travis-ci.org/sindresorhus/mem"><img src="https://travis-ci.org/sindresorhus/mem.svg?branch=master" alt="Build Status" /></a></h1>

<blockquote>
  <p><a href="https://en.wikipedia.org/wiki/Memoization">Memoize</a> functions - An optimization used to speed up consecutive function calls by caching the result of calls with identical input</p>
</blockquote>

<h2>Install</h2>

<p><code>
$ npm install --save mem
</code></p>

<h2>Usage</h2>

<p>```js
const mem = require(‘mem’);</p>

<p>let i = 0;
const counter = () => ++i;
const memoized = mem(counter);</p>

<p>memoized(‘foo’);
//=> 1</p>

<p>// cached as it’s the same arguments
memoized(‘foo’);
//=> 1</p>

<p>// not cached anymore as the arguments changed
memoized(‘bar’);
//=> 2</p>

<p>memoized(‘bar’);
//=> 2
```</p>

<h5>Works fine with promise returning functions</h5>

<p>```js
const mem = require(‘mem’);</p>

<p>let i = 0;
const counter = () => Promise.resolve(++i);
const memoized = mem(counter);</p>

<p>memoized().then(a => {
	console.log(a);
	//=> 1</p>

<pre><code>memoized().then(b => {
	// the return value didn't increase as it's cached
	console.log(b);
	//=> 1
}); }); ```
</code></pre>

<p>```js
const mem = require(‘mem’);
const got = require(‘got’);
const memGot = mem(got, {maxAge: 1000});</p>

<p>memGot(‘sindresorhus.com’).then(() => {
	// this call is cached
	memGot(‘sindresorhus.com’).then(() => {
		setTimeout(() => {
			// this call is not cached as the cache has expired
			memGot(‘sindresorhus.com’).then(() => {});
		}, 2000);
	});
});
```</p>

<h2>API</h2>

<h3>mem(fn, [options])</h3>

<h4>fn</h4>

<p>Type: <code>Function</code></p>

<p>Function to be memoized.</p>

<h4>options</h4>

<h5>maxAge</h5>

<p>Type: <code>number</code><br />
Default: <code>Infinity</code></p>

<p>Milliseconds until the cache expires.</p>

<h5>cacheKey</h5>

<p>Type: <code>Function</code></p>

<p>Determines the cache key for storing the result based on the function arguments. By default, if there’s only one argument and it’s a <a href="https://developer.mozilla.org/en-US/docs/Glossary/Primitive">primitive</a>, it’s used directly as a key, otherwise it’s all the function arguments JSON stringified as an array.</p>

<p>You could for example change it to only cache on the first argument <code>x => JSON.stringify(x)</code>.</p>

<h5>cache</h5>

<p>Type: <code>Object</code><br />
Default: <code>new Map()</code></p>

<p>Use a different cache storage. Must implement the following methods: <code>.has(key)</code>, <code>.get(key)</code>, <code>.set(key, value)</code>, and optionally <code>.clear()</code>. You could for example use a <code>WeakMap</code> instead.</p>

<h3>mem.clear(fn)</h3>

<p>Clear all cached data of a memoized function.</p>

<h4>fn</h4>

<p>Type: <code>Function</code></p>

<p>Memoized function.</p>

<h2>Tips</h2>

<h3>Cache statistics</h3>

<p>If you want to know how many times your cache had a hit or a miss, you can make use of <a href="https://github.com/SamVerschueren/stats-map">stats-map</a> as a replacement for the default cache.</p>

<h4>Example</h4>

<p>```js
const mem = require(‘mem’);
const StatsMap = require(‘stats-map’);
const got = require(‘got’);</p>

<p>const cache = new StatsMap();
const memGot = mem(got, {cache});</p>

<p>memGot(‘sindresorhus.com’)
	.then(() => memGot(‘sindresorhus.com’))
	.then(() => memGot(‘sindresorhus.com’));</p>

<p>console.log(cache.stats);
//=> {hits: 2, misses: 1}
```</p>

<h2>License</h2>

<p>MIT © <a href="https://sindresorhus.com">Sindre Sorhus</a></p>